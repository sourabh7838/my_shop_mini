import { allAPIs } from '../api.js';
import { BugError } from '../../../public/node/error.js';
import { isTruthy } from '@shopify/cli-kit/node/context/utilities';
/**
 * Generate a flat array with all the default scopes for all the APIs plus
 * any custom scope defined by the user.
 * @param extraScopes - custom user-defined scopes
 * @returns Array of scopes
 */
export function allDefaultScopes(extraScopes = [], systemEnvironment = process.env) {
    let scopes = allAPIs.map((api) => defaultApiScopes(api, systemEnvironment)).flat();
    scopes = ['openid', ...scopes, ...extraScopes].map(scopeTransform);
    return Array.from(new Set(scopes));
}
/**
 * Generate a flat array with the default scopes for the given API plus
 * any custom scope defined by the user
 * @param api - API to get the scopes for
 * @param extraScopes - custom user-defined scopes
 * @returns Array of scopes
 */
export function apiScopes(api, extraScopes = [], systemEnvironment = process.env) {
    const scopes = [...defaultApiScopes(api, systemEnvironment), ...extraScopes.map(scopeTransform)].map(scopeTransform);
    return Array.from(new Set(scopes));
}
function defaultApiScopes(api, systemEnvironment = process.env) {
    switch (api) {
        case 'admin':
            return ['graphql', 'themes', 'collaborator'];
        case 'storefront-renderer':
            return ['devtools'];
        case 'partners':
            return ['cli'];
        case 'business-platform':
            return isTruthy(systemEnvironment.USE_APP_MANAGEMENT_API)
                ? ['destinations', 'store-management']
                : ['destinations'];
        case 'app-management':
            return isTruthy(systemEnvironment.USE_APP_MANAGEMENT_API) ? ['app-management'] : [];
        default:
            throw new BugError(`Unknown API: ${api}`);
    }
}
function scopeTransform(scope) {
    switch (scope) {
        case 'graphql':
            return 'https://api.shopify.com/auth/shop.admin.graphql';
        case 'themes':
            return 'https://api.shopify.com/auth/shop.admin.themes';
        case 'collaborator':
            return 'https://api.shopify.com/auth/partners.collaborator-relationships.readonly';
        case 'cli':
            return 'https://api.shopify.com/auth/partners.app.cli.access';
        case 'devtools':
            return 'https://api.shopify.com/auth/shop.storefront-renderer.devtools';
        case 'destinations':
            return 'https://api.shopify.com/auth/destinations.readonly';
        case 'store-management':
            return 'https://api.shopify.com/auth/organization.store-management';
        case 'app-management':
            return 'https://api.shopify.com/auth/organization.apps.manage';
        default:
            return scope;
    }
}
//# sourceMappingURL=scopes.js.map