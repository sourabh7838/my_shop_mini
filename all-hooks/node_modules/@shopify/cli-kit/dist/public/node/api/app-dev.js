import { graphqlRequestDoc } from './graphql.js';
import { normalizeStoreFqdn } from '../context/fqdn.js';
import Bottleneck from 'bottleneck';
// API Rate limiter
// Jobs are launched every 150ms
// Only 10 requests can be executed concurrently.
const limiter = new Bottleneck({
    minTime: 150,
    maxConcurrent: 10,
});
/**
 * Executes an org-scoped GraphQL query against the App Management API.
 * Uses typed documents.
 *
 * @param query - GraphQL query to execute.
 * @param shopFqdn - The shop fqdn.
 * @param token - Partners token.
 * @param variables - GraphQL variables to pass to the query.
 * @returns The response of the query of generic type <T>.
 */
export async function appDevRequest(query, shopFqdn, token, variables) {
    const api = 'App Dev';
    const normalizedShopFqdn = await normalizeStoreFqdn(shopFqdn);
    const url = `https://${normalizedShopFqdn}/app_dev/unstable/graphql.json`;
    const result = limiter.schedule(() => graphqlRequestDoc({
        query,
        api,
        url,
        token,
        variables,
    }));
    return result;
}
//# sourceMappingURL=app-dev.js.map