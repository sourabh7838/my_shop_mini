{"version":3,"file":"factories.js","sourceRoot":"","sources":["../../../../src/public/node/themes/factories.ts"],"names":[],"mappings":"AACA,OAAO,EAAsC,SAAS,EAAC,MAAM,oCAAoC,CAAA;AAuBjG,MAAM,UAAU,UAAU,CAAC,SAA+B;IACxD,IAAI,CAAC,SAAS;QAAE,OAAM;IAEtB,SAAS,CAAC,UAAU,KAApB,SAAS,CAAC,UAAU,GAAK,KAAK,EAAA;IAC9B,SAAS,CAAC,gBAAgB,KAA1B,SAAS,CAAC,gBAAgB,GAAK,KAAK,EAAA;IAEpC,MAAM,EAAC,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,UAAU,EAAE,gBAAgB,EAAC,GAAG,SAAS,CAAA;IAEhE,OAAO;QACL,EAAE;QACF,IAAI;QACJ,UAAU;QACV,gBAAgB;QAChB,IAAI,EAAE,IAAI,KAAK,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI;KACtC,CAAA;AACH,CAAC;AAED,MAAM,UAAU,aAAa,CAAC,KAA2B;IACvD,IAAI,CAAC,KAAK;QAAE,OAAM;IAElB,MAAM,EAAC,GAAG,EAAE,QAAQ,EAAC,GAAG,KAAK,CAAA;IAC7B,OAAO,EAAC,GAAG,EAAE,QAAQ,EAAC,CAAA;AACxB,CAAC;AAID,MAAM,UAAU,eAAe,CAAC,KAA2B;IACzD,IAAI,CAAC,KAAK;QAAE,OAAM;IAElB,MAAM,EAAC,GAAG,EAAE,QAAQ,EAAE,UAAU,EAAE,KAAK,EAAC,GAAG,KAAK,CAAA;IAChD,gGAAgG;IAChG,MAAM,KAAK,GAAG,EAAC,IAAI,EAAE,CAAC,KAAK,IAAI,UAAU,IAAI,EAAE,CAAC,CAAC,MAAM,EAAE,KAAK,EAAE,IAAI,CAAC,GAAG,EAAE,EAAC,CAAA;IAC3E,OAAO,EAAC,GAAG,EAAE,QAAQ,EAAE,UAAU,EAAE,KAAK,EAAE,KAAK,EAAC,CAAA;AAClD,CAAC;AAED,MAAM,UAAU,sBAAsB,CACpC,kBAA8C,EAC9C,MAAqB;IAErB,IAAI,CAAC,kBAAkB,EAAE;QACvB,OAAO,EAAE,CAAA;KACV;IAED,OAAO,kBAAkB,CAAC,GAAG,CAAC,CAAC,UAAU,EAAE,KAAK,EAAE,EAAE;QAClD,OAAO;YACL,oEAAoE;YACpE,GAAG,EAAE,MAAM,CAAC,KAAK,CAAE,CAAC,GAAG;YACvB,OAAO,EAAE,UAAU,CAAC,IAAI,KAAK,GAAG;YAChC,MAAM,EAAE,UAAU,CAAC,IAAI,CAAC,MAAM,IAAI,EAAE;YACpC,KAAK,EAAE,UAAU,CAAC,IAAI,CAAC,KAAK;YAC5B,SAAS,EAAE,SAAS,CAAC,MAAM;SAC5B,CAAA;IACH,CAAC,CAAC,CAAA;AACJ,CAAC","sourcesContent":["import {AssetParams} from './api.js'\nimport {Result, Checksum, Theme, ThemeAsset, Operation} from '@shopify/cli-kit/node/themes/types'\n\ninterface RemoteThemeResponse {\n  id: number\n  name: string\n  role: string\n  createdAtRuntime?: boolean\n  processing?: boolean\n}\n\ninterface RemoteAssetResponse {\n  key: string\n  checksum: string\n  attachment: string | undefined\n  // value is an empty string ('') when the file is empty\n  value: string\n}\n\nexport interface RemoteBulkUploadResponse {\n  body: {asset?: RemoteAssetResponse; errors?: {asset: string[]}}\n  code: number\n}\n\nexport function buildTheme(themeJson?: RemoteThemeResponse): Theme | undefined {\n  if (!themeJson) return\n\n  themeJson.processing ??= false\n  themeJson.createdAtRuntime ??= false\n\n  const {id, name, role, processing, createdAtRuntime} = themeJson\n\n  return {\n    id,\n    name,\n    processing,\n    createdAtRuntime,\n    role: role === 'main' ? 'live' : role,\n  }\n}\n\nexport function buildChecksum(asset?: RemoteAssetResponse): Checksum | undefined {\n  if (!asset) return\n\n  const {key, checksum} = asset\n  return {key, checksum}\n}\n\nexport function buildThemeAsset(asset: undefined): undefined\nexport function buildThemeAsset(asset: RemoteAssetResponse): ThemeAsset\nexport function buildThemeAsset(asset?: RemoteAssetResponse): ThemeAsset | undefined {\n  if (!asset) return\n\n  const {key, checksum, attachment, value} = asset\n  // Note: for attachments, this is the size of the base64 string, not the real length of the file\n  const stats = {size: (value || attachment || '').length, mtime: Date.now()}\n  return {key, checksum, attachment, value, stats}\n}\n\nexport function buildBulkUploadResults(\n  bulkUploadResponse: RemoteBulkUploadResponse[],\n  assets: AssetParams[],\n): Result[] {\n  if (!bulkUploadResponse) {\n    return []\n  }\n\n  return bulkUploadResponse.map((bulkUpload, index) => {\n    return {\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      key: assets[index]!.key,\n      success: bulkUpload.code === 200,\n      errors: bulkUpload.body.errors || {},\n      asset: bulkUpload.body.asset,\n      operation: Operation.Upload,\n    }\n  })\n}\n"]}