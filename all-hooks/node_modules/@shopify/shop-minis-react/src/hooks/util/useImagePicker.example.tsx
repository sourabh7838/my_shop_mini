import React, {useState} from 'react'

import {Camera, Image} from 'lucide-react'

import {Alert, AlertDescription, AlertTitle} from '../../components/ui/alert'
import {Button} from '../../components/ui/button'
import {
  Card,
  CardContent,
  CardHeader,
  CardTitle,
} from '../../components/ui/card'

import {useImagePicker} from './useImagePicker'

export const UseImagePickerExample = () => {
  const [selectedImage, setSelectedImage] = useState<string | null>(null)
  const [error, setError] = useState<string | null>(null)
  const {openCamera, openGallery, ImagePickerInputs} = useImagePicker({
    cameraFacing: 'user',
  })

  const handleCameraCapture = async () => {
    try {
      setError(null)
      const file = await openCamera()
      const url = URL.createObjectURL(file)
      setSelectedImage(url)
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Failed to capture image')
    }
  }

  const handleGallerySelect = async () => {
    try {
      setError(null)
      const file = await openGallery()
      const url = URL.createObjectURL(file)
      setSelectedImage(url)
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Failed to select image')
    }
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle>Image Picker Example</CardTitle>
      </CardHeader>
      <CardContent className="space-y-4">
        <ImagePickerInputs />

        <div className="flex gap-2">
          <Button onClick={handleCameraCapture} variant="primary">
            <Camera className="mr-2 h-4 w-4" />
            Open Camera
          </Button>

          <Button onClick={handleGallerySelect} variant="secondary">
            <Image className="mr-2 h-4 w-4" />
            Open Gallery
          </Button>
        </div>

        {error && (
          <Alert variant="destructive">
            <AlertTitle>Error</AlertTitle>
            <AlertDescription>{error}</AlertDescription>
          </Alert>
        )}

        {selectedImage && (
          <div className="space-y-2">
            <h3 className="text-sm font-medium">Selected Image:</h3>
            <img
              src={selectedImage}
              alt="Selected"
              className="w-full rounded-md border"
            />
          </div>
        )}
      </CardContent>
    </Card>
  )
}
