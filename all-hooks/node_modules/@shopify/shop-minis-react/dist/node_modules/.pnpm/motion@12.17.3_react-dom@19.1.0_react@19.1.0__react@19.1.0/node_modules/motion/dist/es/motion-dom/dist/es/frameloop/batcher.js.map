{"version":3,"file":"batcher.js","sources":["../../../../../../../../../../../../node_modules/.pnpm/motion@12.17.3_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/motion/dist/es/motion-dom/dist/es/frameloop/batcher.mjs"],"sourcesContent":["import { stepsOrder } from './order.mjs';\nimport { createRenderStep } from './render-step.mjs';\nimport { MotionGlobalConfig } from '../../../../motion-utils/dist/es/global-config.mjs';\n\nconst maxElapsed = 40;\nfunction createRenderBatcher(scheduleNextBatch, allowKeepAlive) {\n    let runNextFrame = false;\n    let useDefaultElapsed = true;\n    const state = {\n        delta: 0.0,\n        timestamp: 0.0,\n        isProcessing: false,\n    };\n    const flagRunNextFrame = () => (runNextFrame = true);\n    const steps = stepsOrder.reduce((acc, key) => {\n        acc[key] = createRenderStep(flagRunNextFrame, allowKeepAlive ? key : undefined);\n        return acc;\n    }, {});\n    const { setup, read, resolveKeyframes, preUpdate, update, preRender, render, postRender, } = steps;\n    const processBatch = () => {\n        const timestamp = MotionGlobalConfig.useManualTiming\n            ? state.timestamp\n            : performance.now();\n        runNextFrame = false;\n        if (!MotionGlobalConfig.useManualTiming) {\n            state.delta = useDefaultElapsed\n                ? 1000 / 60\n                : Math.max(Math.min(timestamp - state.timestamp, maxElapsed), 1);\n        }\n        state.timestamp = timestamp;\n        state.isProcessing = true;\n        // Unrolled render loop for better per-frame performance\n        setup.process(state);\n        read.process(state);\n        resolveKeyframes.process(state);\n        preUpdate.process(state);\n        update.process(state);\n        preRender.process(state);\n        render.process(state);\n        postRender.process(state);\n        state.isProcessing = false;\n        if (runNextFrame && allowKeepAlive) {\n            useDefaultElapsed = false;\n            scheduleNextBatch(processBatch);\n        }\n    };\n    const wake = () => {\n        runNextFrame = true;\n        useDefaultElapsed = true;\n        if (!state.isProcessing) {\n            scheduleNextBatch(processBatch);\n        }\n    };\n    const schedule = stepsOrder.reduce((acc, key) => {\n        const step = steps[key];\n        acc[key] = (process, keepAlive = false, immediate = false) => {\n            if (!runNextFrame)\n                wake();\n            return step.schedule(process, keepAlive, immediate);\n        };\n        return acc;\n    }, {});\n    const cancel = (process) => {\n        for (let i = 0; i < stepsOrder.length; i++) {\n            steps[stepsOrder[i]].cancel(process);\n        }\n    };\n    return { schedule, cancel, state, steps };\n}\n\nexport { createRenderBatcher };\n"],"names":["maxElapsed","createRenderBatcher","scheduleNextBatch","allowKeepAlive","runNextFrame","useDefaultElapsed","state","flagRunNextFrame","steps","stepsOrder","acc","key","createRenderStep","setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender","processBatch","timestamp","MotionGlobalConfig","wake","step","process","keepAlive","immediate","i"],"mappings":";;;AAIA,MAAMA,IAAa;AACnB,SAASC,EAAoBC,GAAmBC,GAAgB;AAC5D,MAAIC,IAAe,IACfC,IAAoB;AACxB,QAAMC,IAAQ;AAAA,IACV,OAAO;AAAA,IACP,WAAW;AAAA,IACX,cAAc;AAAA,EACjB,GACKC,IAAmB,MAAOH,IAAe,IACzCI,IAAQC,EAAW,OAAO,CAACC,GAAKC,OAClCD,EAAIC,CAAG,IAAIC,EAAiBL,CAAkD,GACvEG,IACR,EAAE,GACC,EAAE,OAAAG,GAAO,MAAAC,GAAM,kBAAAC,GAAkB,WAAAC,GAAW,QAAAC,GAAQ,WAAAC,GAAW,QAAAC,GAAQ,YAAAC,EAAU,IAAMZ,GACvFa,IAAe,MAAM;AACvB,UAAMC,IAAYC,EAAmB,kBAC/BjB,EAAM,YACN,YAAY,IAAK;AACvB,IAAAF,IAAe,IACVmB,EAAmB,oBACpBjB,EAAM,QAAQD,IACR,MAAO,KACP,KAAK,IAAI,KAAK,IAAIiB,IAAYhB,EAAM,WAAWN,CAAU,GAAG,CAAC,IAEvEM,EAAM,YAAYgB,GAClBhB,EAAM,eAAe,IAErBO,EAAM,QAAQP,CAAK,GACnBQ,EAAK,QAAQR,CAAK,GAClBS,EAAiB,QAAQT,CAAK,GAC9BU,EAAU,QAAQV,CAAK,GACvBW,EAAO,QAAQX,CAAK,GACpBY,EAAU,QAAQZ,CAAK,GACvBa,EAAO,QAAQb,CAAK,GACpBc,EAAW,QAAQd,CAAK,GACxBA,EAAM,eAAe,IACjBF,KAAgBD,MAChBE,IAAoB,IACpBH,EAAkBmB,CAAY;AAAA,EAErC,GACKG,IAAO,MAAM;AACf,IAAApB,IAAe,IACfC,IAAoB,IACfC,EAAM,gBACPJ,EAAkBmB,CAAY;AAAA,EAErC;AAeD,SAAO,EAAE,UAdQZ,EAAW,OAAO,CAACC,GAAKC,MAAQ;AAC7C,UAAMc,IAAOjB,EAAMG,CAAG;AACtB,WAAAD,EAAIC,CAAG,IAAI,CAACe,GAASC,IAAY,IAAOC,IAAY,QAC3CxB,KACDoB,EAAM,GACHC,EAAK,SAASC,GAASC,GAAWC,CAAS,IAE/ClB;AAAA,EACV,GAAE,EAAE,GAMc,QALJ,CAACgB,MAAY;AACxB,aAASG,IAAI,GAAGA,IAAIpB,EAAW,QAAQoB;AACnC,MAAArB,EAAMC,EAAWoB,CAAC,CAAC,EAAE,OAAOH,CAAO;AAAA,EAE1C,GAC0B,OAAApB,GAAO,OAAAE,EAAO;AAC7C;","x_google_ignoreList":[0]}