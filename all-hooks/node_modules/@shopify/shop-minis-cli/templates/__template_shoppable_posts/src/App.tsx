import {useMemo} from 'react'
import {StatusBar} from 'react-native'
import {
  ShoppablePosts,
  useMinisParams,
  SafeAreaView,
  Box,
  shoppablePostsFixture,
} from '@shopify/shop-minis-platform-sdk'

/**
 * A stub type to get you started. Remove this in favor of the type of your extension input query data moving forward.
 */
interface MyExtensionDataType {
  shop?: {
    id: string
  }
}

export function App() {
  const {extensionData} = useMinisParams<MyExtensionDataType>()
  const shopId = extensionData?.shop?.id

  const shoppablePosts = useMemo(() => {
    // Format your data in to the shape expected by `<ShoppablePosts />`
    // return getShoppablePostsFromExtensionData(extensionData)
    return shoppablePostsFixture
  }, [])

  if (!shopId) {
    throw new Error('Shop not found')
  }

  return (
    <Box backgroundColor="foregrounds-contrasting-inverted" flex={1}>
      <StatusBar barStyle="light-content" />
      <SafeAreaView style={{flex: 1}}>
        <ShoppablePosts initialItems={shoppablePosts} shopId={shopId} />
      </SafeAreaView>
    </Box>
  )
}
