import {useEffect, useState} from 'react'
import {
  BundleSelector,
  BundleSelectorItem,
} from '@shopify/shop-minis-ui-extensions'
import {useExtensionShopActions} from '@shopify/shop-minis-platform-sdk/actions'

import type {__QUERY_NAME__QueryData} from './input.graphql'
import seedData from './seed'

export function Render({
  extensionData,
}: {
  extensionData: __QUERY_NAME__QueryData | null
}) {
  // Here we are using seed data to populate the initial state of the bundle selector.
  // You can replace this with the actual data from `extensionData`
  __EXAMPLE_QUERY_DATA_USE__
  const initialBundleSelectorItems: BundleSelectorItem[] = seedData
  const [bundleSelectorItems, setBundleSelectorItems] = useState(
    initialBundleSelectorItems
  )

  const {updateLineItemAttributes} = useExtensionShopActions()

  useEffect(() => {
    if (!bundleSelectorItems) return

    const lineItemAttributes = bundleSelectorItems.map(
      item => item.options.find(option => option.selected)?.value
    )

    updateLineItemAttributes({
      lineItemAttributes: [
        {
          key: '_component_reference',
          value: JSON.stringify(lineItemAttributes),
        },
      ],
    })
  }, [updateLineItemAttributes, bundleSelectorItems])

  if (!bundleSelectorItems) return null

  return (
    <BundleSelector
      items={bundleSelectorItems}
      onChange={setBundleSelectorItems}
    />
  )
}
