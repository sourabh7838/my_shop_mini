import {CodegenConfig, generate} from '@graphql-codegen/cli'

import {SHOP_MINIS_ADMIN_API} from '../src/commands/config.js'

const config: CodegenConfig = {
  schema: {
    [SHOP_MINIS_ADMIN_API]: {
      headers: {
        'X-Shop-Minis-Experimental': '1',
        'X-Shop-Minis-CLI': '1',
      },
    },
  },
  documents: ['src/**/*.ts', '!src/data/partners/query.ts'],
  generates: {
    'src/data/types/autogenerated/shop-minis-admin-api/': {
      preset: 'client-preset',
    },
  },
  hooks: {afterAllFileWrite: ['prettier --write']},

  // Make sure the output is valid esm
  emitLegacyCommonJSImports: false,
}

async function generateTypes() {
  await generate(config, true)
}

generateTypes()
