import { outputDebug } from '@shopify/cli-kit/node/output';
import chalk from 'chalk';
import { gt as semverGreaterThan, lte as semverLowerOrEqual, } from 'semver';
import v0x0x42Upgrade from './v0-0-42/index.js';
import v0x0x43Upgrade from './v0-0-43.js';
import v0x0x44Upgrade from './v0-0-44.js';
import v0x0x45Upgrade from './v0-0-45.js';
import v0x0x50Upgrade from './v0-0-50.js';
import v0x0x54Upgrade from './v0-0-54.js';
import v0x0x56Upgrade from './v0-0-56.js';
import v0x0x57Upgrade from './v0-0-57.js';
import v0x0x58Upgrade from './v0-0-58.js';
import v0x0x61Upgrade from './v0-0-61.js';
import v0x0x63Upgrade from './v0-0-63.js';
import v0x0x64Upgrade from './v0-0-64.js';
import v0x0x75Upgrade from './v0-0-75.js';
import v0x0x76Upgrade from './v0-0-76.js';
import v0x0x77Upgrade from './v0-0-77.js';
import v0x0x79Upgrade from './v0-0-79.js';
import v0x0x84Upgrade from './v0-0-84.js';
import v0x0x85Upgrade from './v0-0-85.js';
import v0x0x89Upgrade from './v0-0-89.js';
import v0x0x91Upgrade from './v0-0-91/index.js';
import v0x0x92Upgrade from './v0-0-92.js';
import v0x0x93Upgrade from './v0-0-93.js';
import v0x0x97Upgrade from './v0-0-97/index.js';
import v0x0x100Upgrade from './v0-0-100.js';
import v0x0x103Upgrade from './v0-0-103.js';
import v0x0x105Upgrade from './v0-0-105.js';
import v0x0x106Upgrade from './v0-0-106.js';
import v0x0x114Upgrade from './v0-0-114.js';
import v0x0x115Upgrade from './v0-0-115.js';
import v0x0x121Upgrade from './v0-0-121.js';
import v0x0x123Upgrade from './v0-0-123.js';
import v0x0x125Upgrade from './v0-0-125.js';
import v0x0x130Upgrade from './v0-0-130.js';
import v0x0x139Upgrade from './v0-0-139.js';
import v0x0x163Upgrade from './v0-0-163.js';
const upgrades = [
    v0x0x42Upgrade,
    v0x0x43Upgrade,
    v0x0x44Upgrade,
    v0x0x45Upgrade,
    v0x0x50Upgrade,
    v0x0x54Upgrade,
    v0x0x56Upgrade,
    v0x0x57Upgrade,
    v0x0x58Upgrade,
    v0x0x61Upgrade,
    v0x0x63Upgrade,
    v0x0x64Upgrade,
    v0x0x75Upgrade,
    v0x0x76Upgrade,
    v0x0x77Upgrade,
    v0x0x79Upgrade,
    v0x0x84Upgrade,
    v0x0x85Upgrade,
    v0x0x89Upgrade,
    v0x0x91Upgrade,
    v0x0x92Upgrade,
    v0x0x93Upgrade,
    v0x0x97Upgrade,
    v0x0x100Upgrade,
    v0x0x103Upgrade,
    v0x0x105Upgrade,
    v0x0x106Upgrade,
    v0x0x114Upgrade,
    v0x0x115Upgrade,
    v0x0x121Upgrade,
    v0x0x123Upgrade,
    v0x0x125Upgrade,
    v0x0x130Upgrade,
    v0x0x139Upgrade,
    v0x0x163Upgrade,
];
// the list of upgrades must be sorted by version. just making sure of it
upgrades.sort(({ version: upgradeVersion1 }, { version: upgradeVersion2 }) => semverGreaterThan(upgradeVersion1, upgradeVersion2) ? 1 : -1);
export async function applyUpgrades({ fromVersion, toVersion, miniHandle, options, }) {
    outputDebug(`Applying upgrades from version ${fromVersion} to version ${toVersion}`);
    for (const { applyUpgrade, version, releaseNotes } of upgrades) {
        if (semverGreaterThan(version, fromVersion) &&
            semverLowerOrEqual(version, toVersion)) {
            outputDebug(`Applying upgrade for version ${version}`);
            await applyUpgrade(miniHandle, options);
            printUpgradeReleaseNotes(version, releaseNotes);
        }
    }
    console.log(''); // add an empty line at the end of release notes
}
function printUpgradeReleaseNotes(version, releaseNotes) {
    if (!releaseNotes.length) {
        return;
    }
    console.log(chalk.bold(`\n@shopify/shop-minis-cli@${version} release notes:`));
    releaseNotes.forEach(releaseNotesItem => {
        console.log(`- ${releaseNotesItem}`);
    });
}
//# sourceMappingURL=index.js.map