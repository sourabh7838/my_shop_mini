import { readFile, writeFile } from 'node:fs/promises';
import path from 'node:path';
import { SemVer } from 'semver';
import { replaceAllSafeAreaImports } from './replace-safe-area-imports.js';
import { replaceDevWrapper } from './replace-dev-wrapper.js';
/**
 * The concept of `features` was added to `manifest.json` with a single feature toggle for `"FULL_BLEED_VIEWER"`.
 * This upgrade exists to add it to the blank template to satisfy our tests, we are not automatically
 * adding it to partner minis.
 *
 * Diff: https://github.com/Shopify/shop-minis-cli/compare/v0.0.84...v0.0.85
 */
async function applyUpgrade() {
    if (process.env.INTERNAL_CODEMODS) {
        const manifestJsonPath = path.join(process.cwd(), 'src/manifest.json');
        const manifestJsonString = await readFile(manifestJsonPath, {
            encoding: 'utf-8',
        });
        const manifestJson = JSON.parse(manifestJsonString) || {};
        manifestJson.features = ['FULL_BLEED_VIEWER'];
        await writeFile(manifestJsonPath, `${JSON.stringify(manifestJson, null, 2)}\n`, {
            encoding: 'utf-8',
        });
    }
    await replaceAllSafeAreaImports();
    await replaceDevWrapper();
}
const releaseNotes = [
    'Changes `SafeAreaView` imports to come from `@shopify/shop-minis-platform-sdk`',
    'Replaces deprecated Wrapper component from `@shopify/shop-minis-platform-sdk` with DevelopmentMiniWrapper from `@shopify/shop-minis-runtime`',
];
const exports = {
    releaseNotes,
    applyUpgrade,
    version: new SemVer('0.0.91'),
};
export default exports;
//# sourceMappingURL=index.js.map