import fs from 'node:fs';
import path from 'node:path';
import { SemVer } from 'semver';
/**
 * src/types.ts was removed from the blank template because it was unused
 * templates were refactored and the screens folder was removed in favour of a single App.tsx file
 * deprecated Wrapper params were removed in index.tsx
 *
 * Diff: https://github.com/Shopify/shop-minis-cli/compare/v0.0.84...v0.0.85
 */
async function applyUpgrade() {
    if (process.env.INTERNAL_CODEMODS) {
        // this file was removed from the blank template because it was unused
        fs.rmSync(path.join(process.cwd(), 'src', 'types.ts'));
        // the screens folder was removed as part of a refactor in the blank template, now the code lives in a single file in src/App.tsx
        fs.rmSync(path.join(process.cwd(), 'src', 'screens'), { recursive: true });
        fs.writeFileSync(path.join(process.cwd(), 'src', 'App.tsx'), newBlankTemplateAppContent, { encoding: 'utf-8' });
        fs.writeFileSync(path.join(process.cwd(), 'src', 'index.tsx'), newBlankTemplateIndexContent, { encoding: 'utf-8' });
    }
    // removes deprecated params props from index.tsx
    const indexTsxPath = path.join(process.cwd(), 'index.tsx');
    const indexTsxContent = fs.readFileSync(indexTsxPath, { encoding: 'utf-8' });
    const newIndexTsxContent = indexTsxContent
        .split('\n')
        .filter(lineOfCode => !lineOfCode.includes('params = {}') && // remove line containing params = {}
        !lineOfCode.includes('params={params}') // remove line containing params={params}
    )
        .join('\n');
    fs.writeFileSync(indexTsxPath, newIndexTsxContent, { encoding: 'utf-8' });
}
const releaseNotes = [
    'Removes deprecated prop "params" from index.tsx',
];
const newBlankTemplateAppContent = `import {Box, Text} from '@shopify/shop-minis-platform-sdk'

export function App() {
  return (
    <Box flex={1} padding="m" backgroundColor="backgrounds-regular">
      <Text textAlign="center">Fill in the blank</Text>
    </Box>
  )
}
`;
const newBlankTemplateIndexContent = `import {MiniAppConfig} from '@shopify/shop-minis-platform-sdk'

import {App} from './App'

const config: MiniAppConfig = {
  Root: App,
}

export default config
`;
const exports = {
    releaseNotes,
    applyUpgrade,
    version: new SemVer('0.0.85'),
};
export default exports;
//# sourceMappingURL=v0-0-85.js.map