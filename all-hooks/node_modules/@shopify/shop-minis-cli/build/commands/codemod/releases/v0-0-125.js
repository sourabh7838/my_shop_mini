import { readFile, writeFile } from 'node:fs/promises';
import path from 'node:path';
import { SemVer } from 'semver';
/**
 * Diff: https://github.com/Shopify/shop-minis-cli/compare/v0.0.124...v0.0.125
 */
async function applyUpgrade() {
    const indexTsxPath = path.join(process.cwd(), 'index.tsx');
    let indexTsxContent = await readFile(indexTsxPath, {
        encoding: 'utf-8',
    });
    indexTsxContent = indexTsxContent.replace('renderDevelopmentMini(MiniApp, {\n  enableApiSandbox: true,\n})', 'renderDevelopmentMini(MiniApp)');
    await writeFile(indexTsxPath, indexTsxContent, {
        encoding: 'utf-8',
    });
    const manifestJsonPath = path.join(process.cwd(), 'src', 'manifest.json');
    const manifestJsonString = await readFile(manifestJsonPath, {
        encoding: 'utf-8',
    });
    const manifestJson = JSON.parse(manifestJsonString);
    delete manifestJson.icon_url;
    await writeFile(manifestJsonPath, `${JSON.stringify(manifestJson, null, 2)}\n`, // keep the new line at the end of the file
    {
        encoding: 'utf-8',
    });
}
const releaseNotes = [
    'Sandbox mode has been removed from the Minis Platform',
    'Deprecate icon_url manifest field',
];
const exports = {
    releaseNotes,
    applyUpgrade,
    version: new SemVer('0.0.125'),
};
export default exports;
//# sourceMappingURL=v0-0-125.js.map