import { readFile, writeFile } from 'node:fs/promises';
import path from 'node:path';
import { SemVer } from 'semver';
import { blankAppTsxBefore, blankAppTsxAfter, shoppablePostsAppTsxBefore, shoppablePostsAppTsxAfter, shoppableVideosAppTsxBefore, shoppableVideosAppTsxAfter, } from './v0-0-93/index.js';
/**
 * Update the templates to use SafeAreaView correctly
 *
 * Diff: https://github.com/Shopify/shop-minis-cli/compare/v0.0.92...v0.0.93
 */
async function applyUpgrade() {
    const existingAppTsxPath = path.join(process.cwd(), 'src', 'App.tsx');
    let existingAppTsxContent = null;
    let newAppTsxContent = null;
    try {
        existingAppTsxContent = await readFile(existingAppTsxPath, {
            encoding: 'utf-8',
        });
    }
    catch (error) {
        // If the App.tsx file doesn't exist or is unreadable for some reason, we don't need to do anything
        return;
    }
    // Only apply the upgrade if the App.tsx file is still one of the old templates
    if (existingAppTsxContent === blankAppTsxBefore) {
        newAppTsxContent = blankAppTsxAfter;
    }
    else if (existingAppTsxContent === shoppablePostsAppTsxBefore) {
        newAppTsxContent = shoppablePostsAppTsxAfter;
    }
    else if (existingAppTsxContent === shoppableVideosAppTsxBefore) {
        newAppTsxContent = shoppableVideosAppTsxAfter;
    }
    if (newAppTsxContent) {
        await writeFile(existingAppTsxPath, newAppTsxContent, {
            encoding: 'utf-8',
        });
    }
}
const releaseNotes = [
    'Ensure the templates use SafeAreaView correctly',
];
const exports = {
    releaseNotes,
    applyUpgrade,
    version: new SemVer('0.0.93'),
};
export default exports;
//# sourceMappingURL=v0-0-93.js.map