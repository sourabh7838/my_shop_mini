import { readFile, writeFile } from 'node:fs/promises';
import path from 'node:path';
import { glob } from '@shopify/cli-kit/node/fs';
import { outputDebug } from '@shopify/cli-kit/node/output';
const upgradeFileToNewTheme = (fileContents) => {
    const result = fileContents
        .replace(/(\s+)borderRadius=\{16\}/g, '$1borderRadius="l"')
        .replace(/(\s+)p="(.+)"/g, '$1padding="$2"')
        .replace(/(\s+)pt="(.+)"/g, '$1paddingTop="$2"')
        .replace(/(\s+)pb="(.+)"/g, '$1paddingBottom="$2"')
        .replace(/(\s+)px="(.+)"/g, '$1paddingHorizontal="$2"')
        .replace(/(\s+)py="(.+)"/g, '$1paddingVertical="$2"')
        .replace(/(\s+)mt="(.+)"/g, '$1marginTop="$2"')
        .replace(/(\s+)mb="(.+)"/g, '$1marginBottom="$2"')
        .replace(/(\s+)mx="(.+)"/g, '$1marginHorizontal="$2"')
        .replace(/(\s+)my="(.+)"/g, '$1marginVertical="$2"')
        // This could be smarter but it doesn't need to be
        .replace(/<Box backgroundColor="backgrounds-overlay-secondary" flex=\{1\}>/g, "<Box flex={1} style={{ backgroundColor: 'rgba(203, 203, 202, 0.5)' }}>")
        .replace(/(\s+)color="foregrounds-regular-inverse"/g, '$1color="foregrounds-contrasting"');
    return result;
};
export async function migrateToNewTheme() {
    const files = await glob('**/*.(tsx)', {
        cwd: path.join(process.cwd(), 'src'),
        absolute: true,
        dot: true,
        followSymbolicLinks: false,
    });
    outputDebug(`Scanning ${files.length} files for theme changes`);
    for (const file of files) {
        try {
            const data = await readFile(file, 'utf8');
            outputDebug(`- Processing ${file}`);
            const result = upgradeFileToNewTheme(data);
            if (result === data) {
                outputDebug(`- No changes to ${file}`);
                continue;
            }
            outputDebug(`- Saving changes to ${file}`);
            await writeFile(file, result, 'utf8');
        }
        catch (err) {
            throw new Error(`Failed to update ${file}: ${err}`);
        }
    }
}
//# sourceMappingURL=migrate-to-new-theme.js.map