import Metro from 'metro';
import { getMetroConfig } from './metro-config.js';
import { buildMetroServerMiddleware } from './metro-server-middleware.js';
/**
 * Runs metro mimicking how react-native does it.
 * Reference: https://github.com/facebook/react-native/blob/3c943bbe3a60198519f7ef8083ece76734def9b7/packages/community-cli-plugin/src/commands/start/runServer.js
 */
export async function runMetro(options) {
    const { host, ...metroOptions } = options;
    const metroServerConfig = {
        ...(await getMetroConfig()),
        ...metroOptions,
    };
    const metroServerOptions = {
        host,
        unstable_extraMiddleware: [buildMetroServerMiddleware(options)],
    };
    await Metro.runServer(metroServerConfig, metroServerOptions);
    if (host !== 'localhost') {
        await Metro.runServer(metroServerConfig, {
            ...metroServerOptions,
            host: 'localhost',
        });
    }
}
//# sourceMappingURL=metro-server.js.map