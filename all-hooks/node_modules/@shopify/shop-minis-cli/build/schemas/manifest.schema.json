{
  "$id": "/manifest.schema.json",
  "$schema": "http://json-schema.org/draft-07/schema",
  "type": "object",
  "title": "Shop Mini Manifest",
  "additionalProperties": false,
  "properties": {
    "name": {
      "type": "string",
      "description": "The name of the Mini"
    },
    "handle": {
      "type": "string",
      "description": "A unique identifier for the Mini",
      "pattern": "^(?:@[a-z0-9-*~][a-z0-9-*._~]*/)?[a-z0-9-~][a-z0-9-._~]*$"
    },
    "description": {
      "type": "string",
      "description": "The description of the Mini"
    },
    "activation_subpath": {
      "type": "string",
      "description": "A route on your Mini's Shopify app that will be used to activate (enable entry points) your Mini for the first time. This route path will be appended to the end of the admin URL of the Shopify app. For example, the value 'activate' will correspond to the URL https://admin.shopify.com/store/example-store/apps/my-handle/activate",
      "pattern": "^(?:[a-z0-9~-]+/)*[a-z0-9~-]+$"
    },
    "notification_topics": {
      "type": "array",
      "description": "Specifies the reason for communication and the scope for messages. An example of a topic could be live streaming related notifications related to a merchant",
      "items": {
        "type": "object",
        "required": ["handle", "description", "scope"],
        "properties": {
          "handle": {
            "type": "string",
            "description": "Text identifier of the topic"
          },
          "description": {
            "type": "string",
            "description": "Reason for the communication using the topic"
          },
          "scope": {
            "type": "string",
            "description": "The scope in which messages are processed for the topic. SHOP means each message will be processed in the scope of a specific merchant, PRODUCT means each message will be processed in the scope of a specific product",
            "enum": ["SHOP", "PRODUCT"]
          }
        }
      }
    },
    "notification_templates": {
      "type": "array",
      "description": "Specify the message which will be sent to subscribers when notification is triggered by the mutation",
      "items": {
        "type": "object",
        "required": [
          "handle",
          "topic_handle",
          "title",
          "body",
          "cooldown_minutes"
        ],
        "properties": {
          "handle": {
            "type": "string",
            "description": "Text identifier of the template"
          },
          "topic_handle": {
            "type": "string",
            "description": "Reference to a notification topic"
          },
          "title": {
            "type": "string",
            "description": "Template of notification title, supports interpolation using the Liquid template language"
          },
          "body": {
            "type": "string",
            "description": "Template of notification body, supports interpolation using the Liquid template language"
          },
          "cooldown_minutes": {
            "type": "number",
            "description": "How often the template allowes to send the exact same message to the same user, in minutes"
          }
        }
      }
    },
    "entry_points": {
      "type": "array",
      "description": "A list of entry points that the Mini supports",
      "items": {
        "type": "object",
        "properties": {
          "location": {
            "type": "string",
            "enum": [
              "PRODUCT_PAGE",
              "STORE_PAGE",
              "PRODUCT_PAGE_CONTEXT_MENU",
              "STORE_PAGE_CONTEXT_MENU",
              "ORDER_CONFIRMATION_PAGE",
              "ORDER_MANAGEMENT_PAGE",
              "HOME_FEED"
            ]
          },
          "type": {
            "type": "string",
            "enum": [
              "LINK",
              "DEFAULT_CARD",
              "IMAGE_COLLECTION",
              "VIDEO_COLLECTION",
              "EVENT_CARD_V2",
              "PRODUCT_OFFER_CARD",
              "IMAGE_COLLECTION_V2",
              "VIDEO_COLLECTION_V2"
            ]
          }
        },
        "allOf": [
          {
            "if": {"properties": {"type": {"const": "LINK"}}},
            "then": {"required": ["location"]}
          },
          {
            "if": {"properties": {"type": {"const": "DEFAULT_CARD"}}},
            "then": {"required": ["location"]}
          },
          {
            "if": {"properties": {"type": {"const": "IMAGE_COLLECTION"}}},
            "then": {"required": ["location"]}
          },
          {
            "if": {"properties": {"type": {"const": "IMAGE_COLLECTION_V2"}}},
            "then": {"required": ["location"]}
          },
          {
            "if": {"properties": {"type": {"const": "VIDEO_COLLECTION"}}},
            "then": {"required": ["location"]}
          },
          {
            "if": {"properties": {"type": {"const": "VIDEO_COLLECTION_V2"}}},
            "then": {"required": ["location"]}
          },
          {
            "if": {"properties": {"type": {"const": "EVENT_CARD_V2"}}},
            "then": {"required": ["location"]}
          }
        ]
      }
    },
    "trusted_domains": {
      "type": "array",
      "description": "A list of domains that the minis uses to make requests and fetch information. Requests to domains that are not in this list will fail in production.",
      "uniqueItems": true,
      "items": {
        "type": "string"
      }
    },
    "features": {
      "type": "array",
      "description": "A list of optional features that your Mini has enabled",
      "uniqueItems": true,
      "items": {
        "type": "string",
        "enum": ["FULL_BLEED_VIEWER", "STANDALONE"]
      }
    },
    "permissions": {
      "type": "array",
      "description": "A list of optional permissions that your Mini requires",
      "uniqueItems": true,
      "items": {
        "type": "string",
        "enum": ["CAMERA", "GALLERY", "MICROPHONE"]
      }
    },
    "user_metafield_definitions": {
      "type": "array",
      "description": "A list user metafield definitions",
      "uniqueItems": true,
      "items": {
        "type": "object",
        "required": ["name", "description", "type", "key"],
        "properties": {
          "name": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "type": {
            "type": "string",
            "enum": ["single_line_text_field"]
          },
          "key": {
            "type": "string"
          }
        }
      }
    },
    "proxies": {
      "type": "array",
      "description": "A list of urls to proxy requests to. This enables secure secrets management and rate limiting.",
      "uniqueItems": true,
      "items": {
        "type": "object",
        "properties": {
          "target_url_pattern": {
            "type": "string",
            "description": "The pattern to match URLs against for this proxy",
            "examples": ["https://api.example.com/foo/*"],
            "pattern": "^https?://.*"
          },
          "allowed_methods": {
            "type": "array",
            "description": "Only these methods will be proxied",
            "items": {
              "type": "string",
              "enum": ["GET", "POST", "PUT", "DELETE", "PATCH"]
            }
          },
          "appended_headers": {
            "type": "array",
            "description": "Headers to append to the proxied request. These can include interpolated secrets.",
            "items": {
              "type": "string"
            },
            "examples": [
              "Content-Type: application/json",
              "Authorization: Bearer {{ secrets.my_api_key }}"
            ]
          },
          "user_rate_limit_requests": {
            "type": "number",
            "description": "User rate limiting based on number of requests per interval"
          },
          "user_rate_limit_interval": {
            "type": "number",
            "description": "User rate limiting interval in seconds"
          },
          "body_json_schema": {
            "type": "object",
            "description": "The JSON schema for the body of the proxied request"
          }
        },
        "required": ["target_url_pattern"],
        "unevaluatedProperties": false,
        "additionalProperties": false
      }
    },
    "privacy_policy_url": {
      "type": "string",
      "description": "A URL to the Privacy Policy for this Mini.",
      "pattern": "^https?://.*"
    },
    "terms_url": {
      "type": "string",
      "description": "A URL to the Terms of Service for this Mini.",
      "pattern": "^https?://.*"
    }
  },
  "required": ["name", "handle", "privacy_policy_url", "terms_url"]
}
